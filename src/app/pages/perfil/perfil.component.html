<div class="perfil-container mat-elevation-z4" *ngIf="perfilForm">
  <h2 class="titulo">Mi Perfil</h2>

  <div class="perfil-contenido">
    <!-- Foto de perfil -->
    <div class="foto-container">
      <img [src]="fotoPerfilUrl" class="avatar-header" alt="Foto de perfil">
      <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden #fileInput />
      <button mat-stroked-button color="primary" (click)="fileInput.click()">
        Cambiar Foto
      </button>
    </div>

    <!-- Formulario de edici√≥n -->
    <form [formGroup]="perfilForm" (ngSubmit)="guardarCambios()" class="formulario">

      <!-- Nombre -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="nombre" />
      </mat-form-field>

      <!-- Correo -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Correo</mat-label>
        <input matInput formControlName="correo" type="email" />
      </mat-form-field>

      <!-- üîπ Cliente -->
      <ng-container *ngIf="esCliente">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tel√©fono</mat-label>
          <input matInput formControlName="telefono" type="tel" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Direcci√≥n</mat-label>
          <input matInput formControlName="direccion" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>G√©nero</mat-label>
          <mat-select formControlName="genero">
            <mat-option value="masculino">Masculino</mat-option>
            <mat-option value="femenino">Femenino</mat-option>
            <mat-option value="otro">Otro</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Fecha de nacimiento</mat-label>
          <input matInput [matDatepicker]="pickerFechaCliente" formControlName="fecha_nacimiento">
          <mat-datepicker-toggle matSuffix [for]="pickerFechaCliente"></mat-datepicker-toggle>
          <mat-datepicker #pickerFechaCliente></mat-datepicker>
        </mat-form-field>
      </ng-container>

      <!-- üîπ Peluquero / Barbero -->
      <ng-container *ngIf="esPeluquero">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tel√©fono Profesional</mat-label>
          <input matInput formControlName="telefono_profesional" type="tel" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Direcci√≥n Profesional</mat-label>
          <input matInput formControlName="direccion_profesional" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>G√©nero</mat-label>
          <mat-select formControlName="genero">
            <mat-option value="masculino">Masculino</mat-option>
            <mat-option value="femenino">Femenino</mat-option>
            <mat-option value="otro">Otro</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Fecha de nacimiento</mat-label>
          <input matInput [matDatepicker]="pickerFechaPeluquero" formControlName="fecha_nacimiento">
          <mat-datepicker-toggle matSuffix [for]="pickerFechaPeluquero"></mat-datepicker-toggle>
          <mat-datepicker #pickerFechaPeluquero></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Experiencia (a√±os)</mat-label>
          <input matInput formControlName="experiencia" type="number" min="0" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Especialidades (separadas por coma)</mat-label>
          <input matInput formControlName="especialidades" />
        </mat-form-field>

        <!-- üîπ Sede (solo visualizaci√≥n) -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Sede</mat-label>
          <input matInput 
                [value]="perfilForm.get('sede')?.value || ''" 
                readonly />
        </mat-form-field>

        <!-- üîπ Puesto de trabajo (solo visualizaci√≥n) -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Puesto de trabajo</mat-label>
          <input matInput 
                [value]="perfilForm.get('puestoTrabajo')?.value || ''" 
                readonly />
        </mat-form-field>
      </ng-container>

      <!-- üîπ Contrase√±as -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Contrase√±a actual</mat-label>
        <input matInput [type]="ocultarPassword ? 'password' : 'text'" formControlName="actual" />
        <button mat-icon-button matSuffix type="button" (click)="ocultarPassword = !ocultarPassword">
          <mat-icon>{{ ocultarPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nueva contrase√±a</mat-label>
        <input matInput [type]="ocultarPassword ? 'password' : 'text'" formControlName="nueva" />
        <button mat-icon-button matSuffix type="button" (click)="ocultarPassword = !ocultarPassword">
          <mat-icon>{{ ocultarPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmar contrase√±a</mat-label>
        <input matInput [type]="ocultarPassword ? 'password' : 'text'" formControlName="confirmarPassword" />
        <button mat-icon-button matSuffix type="button" (click)="ocultarPassword = !ocultarPassword">
          <mat-icon>{{ ocultarPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
      </mat-form-field>

      <!-- Botones -->
      <div class="botones">
        <button mat-raised-button color="primary" type="submit" [disabled]="perfilForm.invalid">
          Guardar Cambios
        </button>
        <button mat-button color="warn" type="button" (click)="cancelarCambios()">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>

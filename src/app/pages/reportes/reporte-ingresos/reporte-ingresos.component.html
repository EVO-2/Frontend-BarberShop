<div class="container p-4">
  <h2 class="text-xl font-bold mb-4">üìä Reportes del Sistema</h2>

  <!-- üîπ FILTRO DE FECHAS -->
  <form [formGroup]="filtroForm" class="flex flex-wrap gap-3 items-end mb-4">
    <mat-form-field appearance="fill">
      <mat-label>Fecha inicio</mat-label>
      <input matInput type="date" formControlName="fechaInicio" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Fecha fin</mat-label>
      <input matInput type="date" formControlName="fechaFin" />
    </mat-form-field>

    <button mat-raised-button color="primary" type="button" (click)="aplicarFiltro()">
      üîç Aplicar Filtro
    </button>
  </form>

  <!-- üîπ TABS DE REPORTES -->
  <mat-tab-group
    [(selectedIndex)]="tabSeleccionada"
    (selectedIndexChange)="onTabChange($event)"
    class="mt-4"
  >

    <!-- üü¢ TAB 1: Ingresos -->
    <mat-tab label="Ingresos">
      <div *ngIf="cargando" class="text-center p-4">Cargando...</div>

      <div *ngIf="!cargando && citas.length > 0; else sinCitas">
        <table mat-table [dataSource]="citas">

          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>event</mat-icon> Fecha
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.fecha | date }}
            </td>
          </ng-container>

          <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>person</mat-icon> Cliente
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.cliente }}
            </td>
          </ng-container>

          <ng-container matColumnDef="peluquero">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>content_cut</mat-icon> Barbero
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.peluquero }}
            </td>
          </ng-container>

          <ng-container matColumnDef="servicios">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>design_services</mat-icon> Servicios
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.serviciosStr }}
            </td>
          </ng-container>

          <ng-container matColumnDef="subtotal">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>payments</mat-icon> Subtotal
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.subtotal | currency:'COP' }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['fecha','cliente','peluquero','servicios','subtotal']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['fecha','cliente','peluquero','servicios','subtotal'];"></tr>
        </table>

        <!-- üîµ NUEVA TARJETA PROFESIONAL -->
        <div class="resumen-info mt-4">
          <div class="item">
            <mat-icon>event</mat-icon>
            <span><strong>Total citas:</strong> {{ cantidadCitas }}</span>
          </div>

          <div class="item">
            <mat-icon>attach_money</mat-icon>
            <span><strong>Ingresos totales:</strong> {{ total | currency:'COP' }}</span>
          </div>
        </div>

      </div>

      <ng-template #sinCitas>
        <p class="text-center no-results">No hay datos para el rango seleccionado.</p>
      </ng-template>
    </mat-tab>


    <!-- üü° TAB 2: Citas por Barbero -->
    <mat-tab label="Citas por Barbero">
      <div *ngIf="cargando" class="text-center p-4">Cargando...</div>

      <div *ngIf="!cargando && reportesBarberos.length > 0; else sinBarberos">
        <table mat-table [dataSource]="reportesBarberos">

          <ng-container matColumnDef="barbero">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>content_cut</mat-icon> Barbero
              </div>
            </th>
            <td mat-cell *matCellDef="let b">
              {{ b.barbero }}
            </td>
          </ng-container>

          <ng-container matColumnDef="cantidad">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>schedule</mat-icon> Citas atendidas
              </div>
            </th>
            <td mat-cell *matCellDef="let b">
              {{ b.cantidad }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['barbero','cantidad']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['barbero','cantidad'];"></tr>
        </table>
      </div>

      <ng-template #sinBarberos>
        <p class="text-center no-results">No hay datos para el rango seleccionado.</p>
      </ng-template>
    </mat-tab>

    <!-- üîµ TAB 3: Clientes Frecuentes -->
    <mat-tab label="Clientes Frecuentes">
      <div *ngIf="cargando" class="text-center p-4">Cargando...</div>

      <div *ngIf="!cargando && reportesClientes.length > 0; else sinClientes">
        <table mat-table [dataSource]="reportesClientes">

          <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>groups</mat-icon> Cliente
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.cliente }}
            </td>
          </ng-container>

          <ng-container matColumnDef="cantidad">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>event_available</mat-icon> Citas
              </div>
            </th>
            <td mat-cell *matCellDef="let c">
              {{ c.cantidad }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['cliente','cantidad']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['cliente','cantidad'];"></tr>
        </table>
      </div>

      <ng-template #sinClientes>
        <p class="text-center no-results">No hay datos para el rango seleccionado.</p>
      </ng-template>
    </mat-tab>

    <!-- üü£ TAB 4: Inventario -->
    <mat-tab label="Inventario">
      <div *ngIf="cargando" class="text-center p-4">Cargando...</div>

      <div *ngIf="!cargando && reportesInventario.length > 0; else sinInventario">
        <table mat-table [dataSource]="reportesInventario">

          <ng-container matColumnDef="producto">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>inventory_2</mat-icon> Producto
              </div>
            </th>
            <td mat-cell *matCellDef="let p">
              {{ p.producto }}
            </td>
          </ng-container>

          <ng-container matColumnDef="usos">
            <th mat-header-cell *matHeaderCellDef>
              <div class="header-cell">
                <mat-icon>repeat</mat-icon> Usos/Ventas
              </div>
            </th>
            <td mat-cell *matCellDef="let p">
              {{ p.usos }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['producto','usos']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['producto','usos'];"></tr>
        </table>
      </div>

      <ng-template #sinInventario>
        <p class="text-center no-results">No hay datos disponibles.</p>
      </ng-template>
    </mat-tab>

  </mat-tab-group>
</div>

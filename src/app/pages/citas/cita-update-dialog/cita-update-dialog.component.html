<h2 mat-dialog-title>Editar Cita</h2>

<form [formGroup]="citaForm" (ngSubmit)="guardar()" class="cita-form">

  <!-- Mensaje si no editable -->
  <div *ngIf="!esEditable()" class="alert-warning">
    ⚠️ Esta cita no puede editarse (solo se pueden editar las citas pendientes con más de 1 hora de anticipación).
  </div>

  <mat-dialog-content class="dialog-content">
    <div class="form-grid">

      <!-- Fecha y hora -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Fecha y hora</mat-label>
        <input matInput type="datetime-local" formControlName="fecha" [readonly]="!esEditable()">
      </mat-form-field>

      <!-- Sede (readonly) -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Sede</mat-label>
        <input matInput [value]="cita?.sede?.nombre" disabled>
      </mat-form-field>

      <!-- Peluquero (readonly con compareWith) -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Peluquero</mat-label>
        <mat-select formControlName="peluquero" [disabled]="true" [compareWith]="compareById">
          <mat-option *ngFor="let p of peluquerosDropdown" [value]="p._id">
            {{ p.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Puesto de trabajo (readonly con compareWith) -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Puesto de trabajo</mat-label>
        <mat-select formControlName="puestoTrabajoId" [disabled]="true" [compareWith]="compareById">
          <mat-option *ngFor="let pt of puestosTrabajo" [value]="pt._id">
            {{ pt.nombre || pt.codigo }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Observaciones -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Observaciones</mat-label>
        <textarea 
          matInput 
          formControlName="observaciones" 
          rows="3"
          [readonly]="rolUsuario !== 'cliente'">
        </textarea>
      </mat-form-field>

      <!-- Servicios (readonly) -->
      <div class="servicios-section" *ngIf="servicios.length">
        <label class="section-label">Servicios:</label>
        <div class="checkbox-grid">
          <mat-checkbox
            *ngFor="let s of servicios; let i = index"
            [formControl]="serviciosFormControls[i]"
            [disabled]="true">
            {{ s.nombre }}
          </mat-checkbox>
        </div>
      </div>

    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-stroked-button type="button" (click)="cancelar()">Cancelar</button>
    <button mat-raised-button color="primary" type="submit"
            [disabled]="citaForm.invalid || guardando || !esEditable()">
      Guardar
    </button>
  </mat-dialog-actions>
</form>
